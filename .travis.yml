sudo: required

language: node_js
node_js:
  - "4.1"

services:
  - docker

before_install:
  - docker pull chiefy/alpine-vault:0.3.1
  - docker run --name vault -d -p 127.0.0.1:8200:8200 -v $(pwd)/config/dev.hcl:/etc/vault.hcl chiefy/alpine-vault:0.3.1
  - docker ps -a

env:
  VAULT_HOST: 127.0.0.1
  VAULT_PORT: 8200

script:
  - mkdir -p $(pwd)/coverage
  - npm install --quiet
  - npm run coverage

addons:
  code_climate:
    repo_token: 9b083d9de876dd53937f28b364a2493b091ebbb867430325922f20280483863

# clean up the running support processes and then report code coverage to CodeClimate
after_script:
  - docker logs vault
  - docker stop vault
  - docker rm vault
  - codeclimate-test-reporter < lcov.info

notifications:
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/174453f843f3dd2daca7
    on_success: always  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: false     # default: false

