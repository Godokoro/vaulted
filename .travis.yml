sudo: required

language: node_js
node_js:
  - "4.1"

services:
  - docker

before_install:
  - docker pull kenjones/authstore-consul
  - docker pull kenjones/authstore-vault
  - docker pull kenjones/nodejs-mocha
  - docker-compose -f docker-compose-test.yml up -d

env:
  VAULT_HOST: 127.0.0.1
  VAULT_PORT: 8200

script:
  - sleep 30
  - mkdir -p $(pwd)/coverage
  - npm install --quiet
  - npm run coverage

addons:
  code_climate:
    repo_token: 9b083d9de876dd53937f28b364a2493b091ebbb867430325922f20280483863

# clean up the running support processes and then report code coverage to CodeClimate
after_script:
  - docker-compose -f docker-compose-test.yml stop
  - docker-compose -f docker-compose-test.yml rm -f
  - codeclimate-test-reporter < lcov.info

webhooks:
  urls:
    - https://webhooks.gitter.im/e/174453f843f3dd2daca7
  on_success: always  # options: [always|never|change] default: always
  on_failure: always  # options: [always|never|change] default: always
  on_start: false     # default: false

